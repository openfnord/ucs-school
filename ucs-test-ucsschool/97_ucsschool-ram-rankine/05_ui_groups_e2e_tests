#!/usr/share/ucs-test/runner bash
## desc: e2e tests of the frontend module agains production setup
## exposure: dangerous
## tags: [ucsschool-bff-groups]
## external-junit: /tmp/ui_groups_e2e_tests/results/test_e2e_live-combined-report.xml

set -e

HOSTNAME=$(ucr get hostname)
DOMAIN=$(ucr get domainname)

RESULT_FOLDER="/tmp/ui_groups_e2e_tests"
mkdir -p "$RESULT_FOLDER/results"
mkdir -p "$RESULT_FOLDER/screenshots"

docker run --rm \
    --env CYPRESS_SIMPLESAML_DOMAIN=ucs-sso."$DOMAIN" \
    --env CYPRESS_KEYCLOAK_DOMAIN=ucs-sso-ng."$DOMAIN" \
    --env CYPRESS_DEFAULT_USER_NAME=admin \
    --env CYPRESS_DEFAULT_USER_PASSWORD=univention \
    --env FRONTEND_DOMAIN="$HOSTNAME"."$DOMAIN" \
    --env TEST_PREFIX="97_ucsschool-ram-rankine.04_ui_groups_e2e_tests" \
    -v "$RESULT_FOLDER"/results:/e2e-test/cypress/results \
    -v "$RESULT_FOLDER"/screenshots:/e2e-test/cypress/screenshots \
    gitregistry.knut.univention.de/univention/ucsschool-components/ui-groups/cypress-tests:branch-jkeiser-e2e-tests
